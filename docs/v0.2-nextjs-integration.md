# SwallowKit v0.2.0 - Next.js çµ±åˆã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ

## ğŸ¯ æ¦‚è¦

SwallowKit ã¯ Next.js ã‚’å†…éƒ¨ã§æ´»ç”¨ã—ãªãŒã‚‰ã€ç‹¬è‡ªã®ã‚·ãƒ³ãƒ—ãƒ«ãª API ã‚’æä¾›ã™ã‚‹ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã«ãªã‚Šã¾ã—ãŸã€‚

### è¨­è¨ˆæ–¹é‡

âœ… **Next.js ã¯å®Œå…¨ã«éš è”½** - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ Next.js ã‚’æ„è­˜ã™ã‚‹å¿…è¦ãªã—  
âœ… **SSR/CSR è‡ªå‹•åˆ¤åˆ¥ã‚’ç¶­æŒ** - SwallowKit ã®ç‹¬è‡ªæ©Ÿèƒ½  
âœ… **Next.js ã®å¼·åŠ›ãªæ©Ÿèƒ½ã‚’å†…éƒ¨ã§æ´»ç”¨** - ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã€ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ã€æ¥½è¦³çš„æ›´æ–°

## ğŸ“¦ æ–°æ©Ÿèƒ½

### 1. useMutation ãƒ•ãƒƒã‚¯

ãƒŸãƒ¥ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆãƒ‡ãƒ¼ã‚¿å¤‰æ›´ï¼‰ç”¨ã®ä¾¿åˆ©ãªãƒ•ãƒƒã‚¯ã€‚Next.js ã® `useTransition` ã‚’å†…éƒ¨ã§ä½¿ç”¨ã€‚

```typescript
import { useMutation } from 'swallowkit';

const addTodoMutation = useMutation(addTodo, {
  onSuccess: (data) => {
    console.log('Success:', data);
  },
});

// ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ä»˜ãã§å®Ÿè¡Œ
await addTodoMutation.mutate(text);

// å³åº§ã«å®Ÿè¡Œ
await addTodoMutation.mutateAsync(text);
```

**ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£:**
- `mutate` - ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ä»˜ãå®Ÿè¡Œ
- `mutateAsync` - å³åº§ã«å®Ÿè¡Œ
- `isLoading` - ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹
- `isPending` - ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³çŠ¶æ…‹
- `isSuccess` / `isError` - æˆåŠŸãƒ»ã‚¨ãƒ©ãƒ¼çŠ¶æ…‹
- `data` / `error` - çµæœã¨ã‚¨ãƒ©ãƒ¼
- `reset` - çŠ¶æ…‹ãƒªã‚»ãƒƒãƒˆ

### 2. useOptimistic ãƒ•ãƒƒã‚¯

æ¥½è¦³çš„æ›´æ–°ã®ãŸã‚ã®ãƒ•ãƒƒã‚¯ã€‚Next.js ã® `useOptimistic` ã‚’å†…éƒ¨ã§ä½¿ç”¨ã€‚

```typescript
import { useOptimistic } from 'swallowkit';

const [optimisticTodos, addOptimisticTodo] = useOptimistic(todos);

const handleAdd = async (text: string) => {
  // UI ã‚’å³åº§ã«æ›´æ–°
  addOptimisticTodo((prev) => [...prev, { id: 'temp', text }]);
  
  // å®Ÿéš›ã®ã‚µãƒ¼ãƒãƒ¼å‡¦ç†
  await addTodo(text);
};
```

### 3. Next.js ã‚­ãƒ£ãƒƒã‚·ãƒ¥çµ±åˆ

`useServerFn` ãŒè‡ªå‹•çš„ã« Next.js ã® React cache ã‚’æ´»ç”¨ã€‚

```typescript
const { data } = useServerFn(getTodos, [], {
  cache: true,        // React cache ã‚’ä½¿ç”¨ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
  revalidate: 60,     // 60ç§’å¾Œã«å†æ¤œè¨¼
  tags: ['todos'],    // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¿ã‚°
});
```

### 4. ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç„¡åŠ¹åŒ– API

```typescript
import { revalidatePath, revalidateTag } from 'swallowkit';

// ãƒ‘ã‚¹ãƒ™ãƒ¼ã‚¹ã®ç„¡åŠ¹åŒ–
await revalidatePath('/todos');

// ã‚¿ã‚°ãƒ™ãƒ¼ã‚¹ã®ç„¡åŠ¹åŒ–
await revalidateTag('todos');
```

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     SwallowKit Public API           â”‚
â”‚  (ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä½¿ç”¨)                    â”‚
â”‚  - useServerFn (SSR/CSRè‡ªå‹•åˆ¤åˆ¥)    â”‚
â”‚  - useMutation                      â”‚
â”‚  - useOptimistic                    â”‚
â”‚  - defineServerFunction             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“ å†…éƒ¨å®Ÿè£…
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Next.js çµ±åˆãƒ¬ã‚¤ãƒ¤ãƒ¼            â”‚
â”‚  (å®Œå…¨ã«éš è”½)                        â”‚
â”‚  - Server Actions                   â”‚
â”‚  - React cache                      â”‚
â”‚  - useTransition                    â”‚
â”‚  - useOptimistic (Next.js)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ å¤‰æ›´ç‚¹

### ç ´å£Šçš„å¤‰æ›´

1. **peerDependencies ã®è¿½åŠ **
   ```json
   {
     "peerDependencies": {
       "react": ">=18.0.0",
       "react-dom": ">=18.0.0",
       "next": ">=14.0.0"
     }
   }
   ```

2. **useQuery.ts ã‹ã‚‰ useMutation ã®ç§»å‹•**
   - æ–°ã—ã„ `hooks/useMutation.ts` ã«ç§»å‹•
   - ã‚ˆã‚Šå¼·åŠ›ãªæ©Ÿèƒ½ã‚’æä¾›

### éç ´å£Šçš„å¤‰æ›´

1. **useServerFn ã®æ‹¡å¼µ**
   - æ—¢å­˜ã® API ã¯å¤‰æ›´ãªã—
   - ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ï¼‰

2. **æ–°ã—ã„ãƒ•ãƒƒã‚¯ã®è¿½åŠ **
   - `useMutation` - ã‚ˆã‚Šä¾¿åˆ©ãªãƒŸãƒ¥ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³
   - `useOptimistic` - æ¥½è¦³çš„æ›´æ–°

3. **ã‚­ãƒ£ãƒƒã‚·ãƒ¥ API ã®è¿½åŠ **
   - `revalidatePath` - ãƒ‘ã‚¹ç„¡åŠ¹åŒ–
   - `revalidateTag` - ã‚¿ã‚°ç„¡åŠ¹åŒ–

## ğŸ“ æ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ 

```
src/
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useServerFn.ts          # æ—¢å­˜ï¼ˆNext.js cacheçµ±åˆï¼‰
â”‚   â”œâ”€â”€ useMutation.ts          # æ–°è¦
â”‚   â””â”€â”€ useQuery.ts             # æ—¢å­˜ï¼ˆuseMutationå‰Šé™¤ï¼‰
â”œâ”€â”€ next/                       # æ–°è¦ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
â”‚   â”œâ”€â”€ server-action-wrapper.ts
â”‚   â””â”€â”€ use-optimistic.ts
â””â”€â”€ types/
    â””â”€â”€ index.ts                # ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚ªãƒ—ã‚·ãƒ§ãƒ³è¿½åŠ 
```

## ğŸ¨ ä½¿ç”¨ä¾‹

### Before (æ—§ API)

```typescript
// ãƒ‡ãƒ¼ã‚¿å–å¾—
const { data } = useServerFn(getTodos, []);

// ãƒŸãƒ¥ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³
await callServerFn(addTodo, text);
// çŠ¶æ…‹ç®¡ç†ãªã—ã€æ‰‹å‹•ã§ refetch ãŒå¿…è¦
```

### After (æ–° API)

```typescript
// ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆå¤‰æ›´ãªã—ï¼‰
const { data } = useServerFn(getTodos, []);

// ãƒŸãƒ¥ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆæ”¹å–„ï¼‰
const mutation = useMutation(addTodo, {
  onSuccess: () => refetch(),
});
await mutation.mutateAsync(text);
// è‡ªå‹•ã§çŠ¶æ…‹ç®¡ç†ã€onSuccess ã§ refetch

// æ¥½è¦³çš„æ›´æ–°ï¼ˆæ–°æ©Ÿèƒ½ï¼‰
const [optimistic, add] = useOptimistic(data);
add((prev) => [...prev, newItem]);
```

## âœ… ãƒ¡ãƒªãƒƒãƒˆ

### 1. ã‚ˆã‚Šä¾¿åˆ©ãª API

| æ©Ÿèƒ½ | Before | After |
|------|--------|-------|
| ãƒŸãƒ¥ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹ | âŒ ãªã— | âœ… ã‚ã‚Š (isLoading, isSuccess, etc.) |
| æ¥½è¦³çš„æ›´æ–° | âŒ æ‰‹å‹•å®Ÿè£… | âœ… useOptimistic |
| ã‚­ãƒ£ãƒƒã‚·ãƒ¥ | âŒ ãªã— | âœ… è‡ªå‹•ï¼ˆNext.jsï¼‰ |
| ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ | âŒ æ‰‹å‹•å®Ÿè£… | âœ… è‡ªå‹•ï¼ˆuseTransitionï¼‰ |

### 2. Next.js ã®æœ€æ–°æ©Ÿèƒ½ã‚’æ´»ç”¨

- React Server Components å¯¾å¿œæº–å‚™
- è‡ªå‹•çš„ãªã‚­ãƒ£ãƒƒã‚·ãƒ¥æœ€é©åŒ–
- ã‚¹ãƒ ãƒ¼ã‚ºãª UI ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³

### 3. SSR/CSR è‡ªå‹•åˆ¤åˆ¥ã¯ç¶­æŒ

SwallowKit ã®ç‹¬è‡ªæ©Ÿèƒ½ã§ã‚ã‚‹ SSR/CSR è‡ªå‹•åˆ¤åˆ¥ã¯å®Œå…¨ã«ç¶­æŒã•ã‚Œã¾ã™ã€‚

```typescript
// SSRæ™‚: ã‚µãƒ¼ãƒãƒ¼ã§ç›´æ¥å®Ÿè¡Œï¼ˆé«˜é€Ÿï¼‰
// CSRæ™‚: RPCçµŒç”±ã§å‘¼ã³å‡ºã—
const { data } = useServerFn(getTodos, []);
```

## ğŸš€ ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¬ã‚¤ãƒ‰

### Step 1: ä¾å­˜é–¢ä¿‚ã®æ›´æ–°

```bash
npm install next@latest react@latest react-dom@latest
npm install swallowkit@latest
```

### Step 2: useMutation ã¸ã®ç§»è¡Œï¼ˆæ¨å¥¨ï¼‰

```typescript
// Before
const handleAdd = async () => {
  await callServerFn(addTodo, text);
  refetch(); // æ‰‹å‹•ã§ refetch
};

// After
const mutation = useMutation(addTodo, {
  onSuccess: () => refetch(),
});

const handleAdd = async () => {
  await mutation.mutateAsync(text);
  // è‡ªå‹•çš„ã« onSuccess ãŒå‘¼ã°ã‚Œã‚‹
};
```

### Step 3: æ¥½è¦³çš„æ›´æ–°ã®å®Ÿè£…ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

```typescript
const [optimisticData, addOptimistic] = useOptimistic(data);

const handleAdd = async () => {
  // UI ã‚’å³åº§ã«æ›´æ–°
  addOptimistic((prev) => [...prev, tempItem]);
  
  // ã‚µãƒ¼ãƒãƒ¼å‡¦ç†
  await mutation.mutateAsync(text);
};
```

## ğŸ“š ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [Next.js çµ±åˆã‚¬ã‚¤ãƒ‰](./nextjs-integration-guide.md)
- [useServerFn ã‚¬ã‚¤ãƒ‰](./useServerFn-guide.md)

## ğŸ¯ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

ä»Šå¾Œã®æ”¹å–„äºˆå®šï¼š

1. âœ… Next.js çµ±åˆï¼ˆå®Œäº†ï¼‰
2. ğŸ”„ ãƒ•ã‚©ãƒ¼ãƒ çµ±åˆ (`useFormAction`)
3. ğŸ”„ ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å¯¾å¿œ
4. ğŸ”„ Suspense çµ±åˆ
5. ğŸ”„ Azure Static Web Apps å‘ã‘æœ€é©åŒ–

SwallowKit ã¯ Next.js ã®åŠ›ã‚’å€Ÿã‚ŠãªãŒã‚‰ã€ã‚ˆã‚Šã‚·ãƒ³ãƒ—ãƒ«ã§ä½¿ã„ã‚„ã™ã„é–‹ç™ºä½“é¨“ã‚’æä¾›ã—ã¾ã™ï¼
